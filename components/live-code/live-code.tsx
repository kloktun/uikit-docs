"use client"

import { SandpackCodeEditor, SandpackConsole, SandpackFileExplorer, SandpackLayout, SandpackPreview, SandpackProvider } from "@codesandbox/sandpack-react";
import { useState } from "react";

type CodeIcon = "duck" | "search";

interface Props {

    page: string;

    files?: {
        [key: string]: string
    },

    icons?: CodeIcon[]

}

const LiveCode = ({ page, files, icons = []}: Props) => {

    const [code, setCode] = useState<string>(page);
    
    let iconFiles: any = {};

    if(icons.includes("duck")){
        iconFiles["/duck-icon.tsx"] = 
`import React from 'react';

const DuckIcon = () => {

    return (
        <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="none"
        >
            <path
                d="M24 11.0141C24 17.3297 18.7936 22.4508 12.3725 22.4508C7.63978 22.4508 3.57037 19.668 1.75277 15.6775C1.74823 15.6648 1.73961 15.652 1.73553 15.6393C1.69702 15.5555 1.65895 15.466 1.62481 15.3764C1.62391 15.374 1.62349 15.3715 1.62258 15.3691C1.62118 15.3655 1.61864 15.3623 1.61721 15.3587C1.34719 14.6721 1.30001 13.8077 1.29263 13.4448C1.29028 13.3292 1.29443 13.2142 1.30415 13.099C1.32927 12.801 1.37409 12.5049 1.43834 12.2127C1.496 11.9544 1.56933 11.6998 1.65794 11.4504C1.84936 10.946 2.07979 10.4574 2.34714 9.98887C2.59759 9.54619 2.8122 9.08852 3.05131 8.63948C3.15902 8.45009 3.22912 8.24165 3.25776 8.02562C3.26638 7.95343 3.30313 7.66558 3.21919 7.3986C3.17382 7.25013 3.05993 7.01313 2.32355 6.53004C1.73371 6.14456 1.46148 6.06828 0.639794 5.56839C0.493242 5.47758 0.372553 5.40358 0.294967 5.35272C0.225155 5.30876 0.159542 5.25846 0.09896 5.20244C0.0345319 5.14296 0.00413266 5.10074 4.9181e-05 5.0458C-0.000514664 5.01505 0.00377279 4.9844 0.0127534 4.95499C0.0265505 4.9237 0.0455766 4.89498 0.0690146 4.87009C0.0997172 4.83759 0.134488 4.80921 0.172463 4.78564C0.236275 4.74774 0.302338 4.71378 0.370284 4.68393C0.518154 4.62228 0.662924 4.55372 0.809828 4.48979C0.846418 4.47387 0.889073 4.45534 0.938795 4.43376C1.25952 4.29632 1.56667 4.12911 1.85622 3.93432C2.02281 3.8166 2.18109 3.6875 2.3299 3.54794C2.48053 3.40855 2.63979 3.24737 2.66565 3.22194C2.70013 3.18789 2.72146 3.16246 2.7387 3.14566C2.94416 2.92843 3.12511 2.7461 3.25929 2.61415C3.37082 2.50447 3.48307 2.39552 3.59887 2.29036C3.60352 2.28615 3.60823 2.28188 3.61302 2.27755C3.63888 2.25621 3.67336 2.22216 3.721 2.17993L3.77681 2.13453C3.93196 2.00713 4.09888 1.89484 4.27532 1.7992C4.28997 1.79126 4.30471 1.78225 4.31946 1.77448C4.55051 1.65267 4.79551 1.55947 5.04905 1.49692C5.05354 1.49581 5.05838 1.49605 5.06274 1.49449C5.06704 1.49295 5.07091 1.49013 5.07535 1.48907C5.32142 1.42987 5.57362 1.39994 5.82671 1.3999C7.58805 1.3999 9.01364 2.80196 9.01772 4.53274V4.57814C9.0091 4.68802 8.9964 4.79426 8.97916 4.90005C8.97462 4.92956 8.966 4.96362 8.96192 4.99086C8.90267 5.2904 8.88497 5.36501 8.84356 5.5601C8.84202 5.56736 8.84139 5.57496 8.8389 5.58196C8.83649 5.5887 8.83596 5.59599 8.83456 5.60301C8.82662 5.64273 8.8184 5.68797 8.80674 5.74047C8.7033 6.2785 8.64295 6.60314 8.62163 7.04536C8.60728 7.31088 8.61304 7.5771 8.63887 7.84174C8.6541 8.02651 8.68 8.21025 8.71645 8.39203C8.76339 8.63056 8.83111 8.86453 8.91881 9.09124C9.16836 9.71372 9.52181 10.1037 9.82625 10.4384C10.2698 10.9158 10.7858 11.3203 11.3553 11.637C11.5511 11.7448 11.7524 11.8424 11.9583 11.9294C12.163 12.017 12.3728 12.0919 12.5867 12.1537C13.2644 12.3436 13.9681 12.4236 14.6711 12.3907C15.7264 12.3485 16.5014 12.0729 16.9882 11.8954C17.9741 11.5353 18.6461 11.0822 19.1025 10.773C19.6588 10.3884 20.1821 9.9582 20.6671 9.4869C20.6828 9.47166 20.6979 9.45685 20.7134 9.44139C20.8346 9.32016 21.4308 8.70985 22.3158 7.56837C22.3955 7.46564 22.4731 7.3608 22.5513 7.25695C22.5966 7.19338 22.7191 7.03265 22.8267 6.87147C22.9321 6.71406 23.1654 6.72889 23.2338 6.90558C23.7408 8.21456 24.0011 9.60762 24 11.0141Z"
                fill="currentColor"
            />
        </svg>
    );
    
}

export default DuckIcon;`
    }

    if(icons.includes("search")){
        iconFiles["/search-icon.tsx"] = 
`import React from 'react';

const SearchIcon = () => {

	return (
		<svg
			xmlns="http://www.w3.org/2000/svg"
			viewBox="0 0 24 24"
			fill="none"
		>
			<path
				d="M21.7094 20.2914L17.9994 16.6114C19.4395 14.8158 20.1369 12.5367 19.9482 10.2427C19.7595 7.94867 18.6991 5.81415 16.9849 4.27801C15.2708 2.74188 13.0332 1.92088 10.7323 1.98384C8.43145 2.0468 6.24214 2.98893 4.61456 4.61651C2.98698 6.24409 2.04485 8.43341 1.98189 10.7343C1.91893 13.0352 2.73992 15.2727 4.27606 16.9869C5.8122 18.701 7.94672 19.7615 10.2407 19.9502C12.5347 20.1389 14.8138 19.4415 16.6094 18.0014L20.2894 21.6814C20.3824 21.7751 20.493 21.8495 20.6148 21.9003C20.7367 21.951 20.8674 21.9772 20.9994 21.9772C21.1314 21.9772 21.2621 21.951 21.384 21.9003C21.5059 21.8495 21.6165 21.7751 21.7094 21.6814C21.8897 21.4949 21.9904 21.2457 21.9904 20.9864C21.9904 20.727 21.8897 20.4778 21.7094 20.2914ZM10.9994 18.0014C9.61495 18.0014 8.26157 17.5908 7.11042 16.8217C5.95928 16.0525 5.06207 14.9592 4.53226 13.6802C4.00245 12.4011 3.86382 10.9936 4.13392 9.63574C4.40402 8.27787 5.0707 7.03059 6.04967 6.05162C7.02864 5.07265 8.27592 4.40597 9.63378 4.13587C10.9917 3.86578 12.3991 4.0044 13.6782 4.53421C14.9573 5.06403 16.0505 5.96123 16.8197 7.11238C17.5889 8.26352 17.9994 9.6169 17.9994 11.0014C17.9994 12.8579 17.2619 14.6384 15.9492 15.9511C14.6364 17.2639 12.8559 18.0014 10.9994 18.0014Z"
				fill="currentColor"
			/>
		</svg>
	);

}

export default SearchIcon;`
    }

    return (
        <SandpackProvider

            className="!mt-4"

            template="react-ts"
            customSetup={
                { 
                    dependencies: { 
                        "@kloktun/uikit": "latest" 
                    }
                }
            }

            options={
                {
                    activeFile: "/page.tsx",
                    visibleFiles: ["/page.tsx", ...Object.keys(files ?? {}), ...Object.keys(iconFiles ?? {}),  ],
                    
                    externalResources: [
                        "https://cdn.tailwindcss.com"
                    ]
                }
            }
            files={{
                

            "/page.tsx": code,
            ...iconFiles,
            ...files,

            "/App.tsx":   
`import { KloktunUI } from '@kloktun/uikit'
import '@kloktun/uikit/lib/index.css'
import Page from './page'

export default function App() {
    return (
        <KloktunUI>
            <div className="flex flex-col p-4">
                <Page />
            </div>
        </KloktunUI>
    )
}`,
            }
        }
        >
            <div className="flex flex-col w-full border border-gray-200 ">
                <div className="w-full border-b !border-gray-200">
                    <SandpackPreview  className="min-h-[400px] h-[400px]" />
                </div>
                <div className="w-full">
                    <SandpackCodeEditor showTabs />
                </div>
            </div>
        </SandpackProvider>
    );

}

export default LiveCode;